<!DOCTYPE html>
<html lang=en>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öö</text></svg>">
    <link rel="stylesheet" href="/data/css/global.css">
    <link rel="stylesheet" href="/data/css/pygments.css">
    <title></title>
    <meta name="description" content="Engineering brain dumps.">
    <link rel="stylesheet" href="/data/css/blog.css">
    <link rel="icon" href="/data/other/favicon.ico" type="image/gif" />
</head>

<body>
<h1>üè° Adding more features to Hyperion in Homeassistant</h1>
<main>
<p><video src="/data/ani/hyperion-hass.webm"  autoplay loop muted></video></p>

<h2 id="intro">Intro</h2>

<p>After playing around with Hyperion I really liked it, I liked it so much that I decided to implement it in my smart-home setup.  I currently use Hyperion for Kodi, but I wanted a way to control it with my <code>Homeassistant</code>, because I could automate a lot of workflows e.g. automatically turn on the backlight in evenings. My Setup uses two Raspberry Pi devices: First for <code>Kodi + Hyperion</code> and second just for <code>Homeassistant</code>. Okay lets begin.</p>

<p>First open up your terminal and ssh to a machine with has Hyperion service enabled.</p>

<pre><code>ssh kodi@192.168.1.99
</code></pre>

<p>Test if Hyperion commands are working:</p>

<pre><code>hyperion-remote -e "Knight rider"
</code></pre>

<p>If you got your lights running are ok to go!</p>

<p>NOTE: In my case Homeassistant and Hyperion are on a different machine therefore I needed to set up a password-less ssh connection from my Homeassistant RPi ‚Üí Kodi RPi*</p>

<p>Now login to your second machine running <code>Homeassistant</code> service.</p>

<div class="codehilite"><pre><span></span><code>ssh pi@192.168.1.100
sudo su homeassistant
</code></pre></div>

<p>Test the <code>Hyperion</code> again but now in a remote configuration.</p>

<p><strong>WARNING:</strong> You are entering SSH inception, because you are connecting via SSH to Linux machine while already connected to another machine via SSH!</p>

<pre><code>ssh kodi@192.168.1.99 'hyperion-remote -e "Knight rider"'
</code></pre>

<p>It was mentioned previously that this step just ran an SSH command in a different machine entirely via the power of SSH.  If your setup is all in one meaning <code>Hyperion</code> and <code>Homeassistant</code> are running on the same machine then the command would simply be:</p>

<pre><code>hyperion-remote -e "Knight rider"
</code></pre>

<p>Edit <code>Homeassistant</code> configuration files:</p>

<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">üìî configuration.yaml</span> <span class="c1">#</span>

<span class="nt">script</span><span class="p">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">scripts.yaml</span>

<span class="nt">script</span><span class="p">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">groups.yaml</span>

<span class="nt">input_select</span><span class="p">:</span>
  <span class="nt">hyperion_effects</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Hyperion Effects</span>
    <span class="nt">options</span><span class="p">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">hyperion_effect_list.yaml</span>
    <span class="nt">initial</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Rainbow swirl</span>
    <span class="nt">icon</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mdi:white-balance-iridescent</span>

<span class="nt">shell_command</span><span class="p">:</span>
  <span class="nt">run_hyperion_effect</span><span class="p">:</span>  <span class="s">&quot;ssh</span><span class="nv"> </span><span class="s">kodi@192.168.1.99</span><span class="nv"> </span><span class="s">\&quot;hyperion-remote</span><span class="nv"> </span><span class="s">-e</span><span class="nv"> </span><span class="s">&#39;{{states.input_select.hyperion_effects.state}}&#39;\&quot;</span><span class="nv"> </span><span class="s">&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">üìî hyperion_effect_list.yaml (create this file in hass root directory)</span>

<span class="l l-Scalar l-Scalar-Plain">- Rainbow mood</span>
<span class="l l-Scalar l-Scalar-Plain">- Rainbow swirl fast</span>
<span class="l l-Scalar l-Scalar-Plain">- Rainbow swirl</span>
<span class="l l-Scalar l-Scalar-Plain">- Red mood blobs</span>
<span class="l l-Scalar l-Scalar-Plain">- Warm mood blobs</span>
<span class="l l-Scalar l-Scalar-Plain">- Blue mood blobs</span>
<span class="l l-Scalar l-Scalar-Plain">- Full color mood blobs</span>
<span class="l l-Scalar l-Scalar-Plain">- Cold mood blobs</span>
<span class="l l-Scalar l-Scalar-Plain">- Green mood blobs</span>
<span class="l l-Scalar l-Scalar-Plain">- Knight rider</span>
<span class="l l-Scalar l-Scalar-Plain">- Police Lights Single</span>
<span class="l l-Scalar l-Scalar-Plain">- Police Lights Solid</span>
<span class="l l-Scalar l-Scalar-Plain">- Rainbow mood</span>
<span class="l l-Scalar l-Scalar-Plain">- Rainbow swirl fast</span>
<span class="l l-Scalar l-Scalar-Plain">- Rainbow swirl</span>
<span class="l l-Scalar l-Scalar-Plain">- Sparks Color</span>
<span class="l l-Scalar l-Scalar-Plain">- Sparks</span>
<span class="l l-Scalar l-Scalar-Plain">- Strobe blue</span>
<span class="l l-Scalar l-Scalar-Plain">- Strobe Raspbmc</span>
<span class="l l-Scalar l-Scalar-Plain">- Strobe white</span>
<span class="l l-Scalar l-Scalar-Plain">- Color traces</span>
<span class="l l-Scalar l-Scalar-Plain">- X-Mas</span>
<span class="l l-Scalar l-Scalar-Plain">- Cinema brighten lights</span>
<span class="l l-Scalar l-Scalar-Plain">- Cinema dim lights</span>
<span class="l l-Scalar l-Scalar-Plain">- UDP multicast listener</span>
<span class="l l-Scalar l-Scalar-Plain">- UDP listener</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">üìî scripts.yaml</span>

<span class="l l-Scalar l-Scalar-Plain">hyperion_run</span><span class="p p-Indicator">:</span>
  <span class="nt">alias</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run Hyperion Effect</span>
  <span class="nt">sequence</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">alias</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run selected effect</span>
      <span class="nt">service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">shell_command.run_hyperion_effect</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">üìî groups.yaml</span> <span class="c1"># (Optional example to group all items)</span>

<span class="nt">hyperion_group</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Hyperion Control</span>
  <span class="nt">entities</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">input_select.hyperion_effects</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">script.hyperion_run</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">switch.hyperion_service</span>
</code></pre></div>

<h2 id="conclusion">Conclusion</h2>

<p>This guide is a more or less a workaround for running Hyperion effects. I saw other people doing similar things to solve this problem, but it involved shell script for every Hyperion effect. This was due to the fact that <code>shell_command</code> functionality was introduced relatively recently to <code>Homeassistant</code>. I could try extending the feature set and add brightness control but for now it suits my needs. Furthermore, I could add automation to enable Hyperion only in evenings and I actually have done that. For more inspiration you can check out my  <code>Homeassistant</code> config by visiting this <a href="https://github.com/dovydasgulbinas/Home-AssistantConfig">GitHub repository.</a></p>
</main>

<div class="artice-footer-meta">
    <strong>Posted on:</strong>04/25/21 17:13:36,
    <strong>last edited on:</strong>04/25/21 17:13:36,
    <strong>written by:</strong>GitHub
</div><footer>
    <p class=footer-links> 
    <a href="./">Home</a>
    <a href="./rss.xml">RSS</a>
    <a href="./atom.xml">Atom</a>
    </p>
    <p class="footer-engine">Made with <a href="https://pedantic.software/git/blogit">blogit</a></p>
</footer>
</body>
</html>
